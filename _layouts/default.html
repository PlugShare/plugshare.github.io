<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}">
    <link rel="stylesheet" type="text/css" href="{{ '/assets/css/print.css' | relative_url }}" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <title>PlugShare Developer Center</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1><a href="/"><img src="logo.svg" id="logo"><span class="title">PlugShare Developer Center</span></a></h1>
          <!-- <h2>{{ site.description | default: site.github.project_tagline }}</h2> -->
        </header>
        <hr>
        <section id="main_content">
          {{ content }}
        </section>
        <hr>
        <footer>
          <span>Â© 2017 Recargo, Inc.</span>
          <span><a href="http://company.plugshare.com/privacy/">Privacy Policy</a></span>
          <span><a href="http://company.plugshare.com/terms/">Terms of Use</a></span>
          <br>
          {% if site.github.is_project_page %}
            {{ site.title | default: site.github.repository_name }} is maintained by <a href="{{ site.github.owner_url }}">{{ site.github.owner_name }}</a><br>
          {% endif %}
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

      </div>
    </div>

    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-21850385-16', 'auto');
      ga('send', 'pageview');
    </script>
    <script>
      $(document).ready(function(){
        $(".update").on("click", function(e) {
          e.preventDefault();
          updateEmbed();
          $("#widget").html($("#code").val());
          window.scrollTo(0, 0);
        });

        var updateEmbed = function() {
          var height = $("#height").val();
          var width = $("#width").val();

          var url = window.location.href; 
          if (url.indexOf('open'))
            var src = 'https://staging.plugshare.com/widget2.html';
          else
            var src = 'https://staging.plugshare.com/widget.html'; // standard widget shouldn't filter out international options

          var spanLat = $("#spanLat").val();
          var spanLng = $("#spanLng").val();
          var latitude = $("#latitude").val();
          var longitude = $("#longitude").val();

          if (spanLat && spanLng && latitude && longitude) {
            src += '?latitude=' + latitude + '&longitude=' + longitude + '&spanLat=' + spanLat + '&spanLng=' + spanLng;

            // open embed
            var outlets = $('input[name="outlet"]:checked').map(function() {
              return this.value;
            }).get();
            var networks = $('input[name="network"]:checked').map(function() {
              return this.value;
            }).get();
            var type = $('input[name="type"]:checked').val();
            if (outlets.length || networks.length) {
              if (outlets.length) {
                src += '&outlets=[';
                for (var i = 0; i < outlets.length; i++) {
                  if (outlets[i] == '6_0') {
                    src += '{"connector":6,"power":0}';
                  } else if (outlets[i] == '6_1') {
                    src += '{"connector":6,"power":1}';
                  } else {
                    src += '{"connector":' + outlets[i] + '}';
                  }
                  if (i != outlets.length - 1)
                    src += ',';
                }
                src += ']';
              }
              if (networks.length) {
                if (type == 'include')
                  src += '&networks=';
                else if (type == 'exclude')
                  src += '&exclusion_networks=20,24,18,32,16,40,39,11,10,31,17';
                for (var i = 0; i < networks.length; i++) {
                  src += networks[i];
                  if (i != networks.length - 1)
                    src += ',';
                }
              }
            }
          }
          console.log(src);

          code = '<iframe src=\'' + src + '\' width=\'' + width + '\' height=\''+ height + '\'></iframe>';

          $("#code").val(code);
        }
        updateEmbed();
        $("#parameters input").keyup(function() {
          updateEmbed();
        });
        $('input[type=radio], input[type=checkbox]').change(function() {
          updateEmbed();
        });

        $("#network_on").on("click", function() {
          $(':checkbox[name=network]').prop('checked', true);
          updateEmbed();
        });
        $("#network_off").on("click", function() {
          $(':checkbox[name=network]').prop('checked', false);
          updateEmbed();
        });

        $("#outlet_on").on("click", function() {
          $(':checkbox[name=outlet]').prop('checked', true);
          updateEmbed();
        });
        $("#outlet_off").on("click", function() {
          $(':checkbox[name=outlet]').prop('checked', false);
          updateEmbed();
        });

        $("#accept_button").on("click", function() {
          $("#terms").hide();
          $("#snippet").show();
          window.scrollTo(0, document.body.scrollHeight);
        });

        $("#geocode").on("click", function(e) {
          e.preventDefault();
          console.log("geocode");
          $.ajax({
            type: "GET",
            url: "https://maps.googleapis.com/maps/api/geocode/json?address=" + $('#search').val() + "&key=AIzaSyAIomWPUck8__IbdySu_W9f8etuWVOcKjU",
            success: function(data){
              console.log(data);
              console.log(JSON.stringify(data));
              if (data.results.length > 0) {
                var location = data.results[0].geometry.location;
                $("#latitude").val(location.lat);
                $("#longitude").val(location.lng);
                $("#result").show();
                $("#result code").html("Search Result: " + data.results[0].formatted_address);
                updateEmbed();
                $("#widget").html($("#code").val());
              }
            }
          });
        });

        calculate = function() {
          var mile_radius = $("#radius").val();
          var lat = $("#latitude").val();
          var lng = $("#longitude").val();
          var miles_per_lat_degree = 69.172;
          var miles_per_lng_degree = Math.cos(lat) * miles_per_lat_degree;
          var lat_radius = Math.abs(mile_radius/miles_per_lat_degree);
          var lng_radius = Math.abs(mile_radius/miles_per_lng_degree);
          $("#spanLat").val(lat_radius);
          $("#spanLng").val(lng_radius);
          console.log(mile_radius, lat, lng, miles_per_lat_degree, miles_per_lng_degree, lat_radius, lng_radius);
        }

        $("#radius").on('change', function() {
          calculate();
        });
        $("#radius").on('mousewheel', function() {
          setTimeout(function(){ calculate(); }, 10);
        });
        $("#radius").keyup(function() {
          calculate();
        });

      });
    </script>
  </body>
</html>