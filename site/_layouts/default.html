<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}">
    <link rel="stylesheet" type="text/css" href="{{ '/assets/css/print.css' | relative_url }}" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    {% seo %}
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1><a href="/"><img src="logo.svg" id="logo"><span class="title">PlugShare Developer Center</span></a></h1>
          <!-- <h2>{{ site.description | default: site.github.project_tagline }}</h2> -->
        </header>
        <hr>
        <section id="main_content">
          {{ content }}
        </section>
        <hr>
        <footer>
          <span>&copy; <span id="copyright-year">2020</span> Recargo, Inc.</span>
          <span><a href="https://www.recargo.com/privacy.html">Privacy Policy</a></span>
          <span><a href="https://www.recargo.com/terms.html">Terms of Use</a></span>
          <span><a href="http://status.plugshare.com">API Status</a></span>
          <br>
          {% if site.github.is_project_page %}
            {{ site.title | default: site.github.repository_name }} is maintained by <a href="{{ site.github.owner_url }}">{{ site.github.owner_name }}</a><br>
          {% endif %}
          This page was generated by <a href="https://pages.github.com" target="_blank">GitHub Pages</a>.
        </footer>

      </div>
    </div>

    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-21850385-16', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script type="text/javaScript">
      (function(i){if((d=new Date().getFullYear())>parseInt((t=document.getElementById(i)).innerHTML))t.innerHTML=d;})("copyright-year");
    </script>
    <script>
      $(document).ready(function(){
        $(".update").on("click", function(e) {
          e.preventDefault();
          updateEmbed();
          $("#widget").html($("#code").val());
          window.scrollTo(0, 0);
        });

        var updateEmbed = function() {
          var height = $("#height").val();
          var width = $("#width").val();

          var src = 'https://www.plugshare.com/widget2.html';
          var append = '?';

          var latitude = $("#latitude").val();
          var longitude = $("#longitude").val();
          var spanLat = $("#spanLat").val();
          var spanLng = $("#spanLng").val();

          if (latitude && longitude && spanLat && spanLng) {
            src += append;
            append = '&';
            src += 'latitude=' + latitude + '&longitude=' + longitude + '&spanLat=' + spanLat + '&spanLng=' + spanLng;
          }

          // open embed
          var outlets = $('input[name="outlet"]:checked').map(function() {
            return this.value;
          }).get();
          var networks = $('input[name="network"]:checked').map(function() {
            return this.value;
          }).get();
          var type = $('input[name="type"]:checked').val();
          if (outlets.length || networks.length) {
            if (outlets.length) {
              src += append;
              append = '&';
              src += 'plugs=';
              for (var x = 0; x < outlets.length; x++) {
                src += outlets[x];
                if (x != outlets.length - 1)
                  src += ',';
              }
            }
            if (networks.length && networks.length < 28) {
              if (type == 'include') {
                src += append;
                append = '&';
                src += 'networks=';
              } else if (type == 'exclude') {
                src += append;
                append = '&';
                src += 'exclusion_networks=';
              }
              for (var y = 0; y < networks.length; y++) {
                src += networks[y];
                if (y != networks.length - 1)
                  src += ',';
              }
            }
          }

          // console.log(src);

          code = '<iframe src=\'' + src + '\' width=\'' + width + '\' height=\''+ height + '\' allow=\'geolocation\'></iframe>';

          $("#code").val(code);
        }
        updateEmbed();
        $("#parameters input").keyup(function() {
          updateEmbed();
        });
        $('input[type=radio], input[type=checkbox]').change(function() {
          updateEmbed();
        });

        $("#network_on").on("click", function() {
          $(':checkbox[name=network]').prop('checked', true);
          updateEmbed();
        });
        $("#network_off").on("click", function() {
          $(':checkbox[name=network]').prop('checked', false);
          updateEmbed();
        });

        $("#outlet_on").on("click", function() {
          $(':checkbox[name=outlet]').prop('checked', true);
          updateEmbed();
        });
        $("#outlet_off").on("click", function() {
          $(':checkbox[name=outlet]').prop('checked', false);
          updateEmbed();
        });

        $("#accept_button").on("click", function() {
          $("#terms").hide();
          $("#snippet").show();
          window.scrollTo(0, document.body.scrollHeight);
        });

        $("#copy_button").on("click", function() {
          var el = $('#code');

          // handle iOS as a special case
          if (navigator.userAgent.match(/ipad|ipod|iphone/i)) {

            // save current contentEditable/readOnly status
            var editable = el.contentEditable;
            var readOnly = el.readOnly;

            // convert to editable with readonly to stop iOS keyboard opening
            el.contentEditable = true;
            el.readOnly = true;

            // create a selectable range
            var range = document.createRange();
            range.selectNodeContents(el);

            // select the range
            var selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            el.setSelectionRange(0, 999999);

            // restore contentEditable/readOnly to original state
            el.contentEditable = editable;
            el.readOnly = readOnly;
          } else {
            el.select();
          }

          try {
            var successful = document.execCommand('copy');
          } catch (err) {
            alert('Unable to copy to clipboard, manually copy + paste');
          }
        });

        $("#geocode").on("click", function(e) {
          e.preventDefault();
          // console.log("geocode");
          if ($("#search").val()) {
            $.ajax({
              type: "GET",
              url: "https://maps.googleapis.com/maps/api/geocode/json?address=" + $('#search').val() + "&key=AIzaSyAIomWPUck8__IbdySu_W9f8etuWVOcKjU",
              success: function(data){
                // console.log(data);
                // console.log(JSON.stringify(data));
                if (data.results.length > 0) {
                  var location = data.results[0].geometry.location;
                  $("#latitude").val(location.lat);
                  $("#longitude").val(location.lng);
                  $("#result").show();
                  $("#result code").html("Search Result: " + data.results[0].formatted_address);
                  updateEmbed();
                  $("#widget").html($("#code").val());
                }
              }
            });
          } else if ($("#radius").val() > 0) {
            updateEmbed();
            $("#widget").html($("#code").val());
          }
        });

        calculate = function() {
          var mile_radius = $("#radius").val();
          if (mile_radius > 0) {
            var lat = $("#latitude").val();
            var lng = $("#longitude").val();
            var miles_per_lat_degree = 69.172;
            // var miles_per_lng_degree = Math.abs(Math.cos(lat)) * miles_per_lat_degree;
            var miles_per_lng_degree = 69.172;
            // actually seems like no calculation needed here, /region endpoint send it's own modified numbers
            var lat_radius = mile_radius/miles_per_lat_degree;
            var lng_radius = mile_radius/miles_per_lng_degree;
            lat_radius = Math.round(lat_radius * 100000) / 100000;
            lng_radius = Math.round(lng_radius * 100000) / 100000;
            $("#spanLat").val(lat_radius);
            $("#spanLng").val(lng_radius);
            updateEmbed();
            // console.log(mile_radius + " miles at " + lat + ", " + lng);
            // console.log("miles per degree", miles_per_lat_degree, miles_per_lng_degree);
            // console.log("lat, lng in degrees", lat_radius, lng_radius);
          }
        }

        $("#radius").on('change', function() {
          calculate();
        });
        $("#radius").on('mousewheel', function() {
          setTimeout(function(){ calculate(); }, 10);
        });
        $("#radius").keyup(function() {
          calculate();
        });
        $("#spanLat, #spanLng").keyup(function() {
          $("#radius").val('');
        });

      });
    </script>
    <script type="text/javascript" src="https://s3.amazonaws.com/assets.freshdesk.com/widget/freshwidget.js"></script>
    <script type="text/javascript">
      FreshWidget.init("", {"queryString": "&widgetType=popup&captcha=yes", "utf8": "✓", "widgetType": "popup", "buttonType": "text", "buttonText": "Help & Support", "buttonColor": "white", "buttonBg": "#003ca6", "alignment": "4", "offset": "400px", "formHeight": "500px", "captcha": "yes", "url": "https://recargo.freshdesk.com"} );
    </script>
  </body>
</html>
